M2ExZ


In the domain generalization literature, a common objective is to learn representations independent of the domain after conditioning on the class label. We show that this objective is not sufficient: there exist counter-examples where a model fails to generalize to unseen domains even after satisfying class-conditional domain invariance. We formalize this observation through a structural causal model and show the importance of modeling within-class variations for generalization. Specifically, classes contain objects that characterize specific causal features, and domains can be interpreted as interventions on these objects that change non-causal features. We highlight an alternative condition: inputs across domains should have the same representation if they are derived from the same object. Based on this objective, we propose  matching-based algorithms when base objects are observed (e.g., through data augmentation) and approximate the objective when objects are not observed (MatchDG). Our simple matching-based algorithms are competitive to prior work on out-of-domain accuracy for rotated MNIST, Fashion-MNIST, PACS, and Chest-Xray datasets. Our method MatchDG also recovers ground-truth object matches: on MNIST and Fashion-MNIST, top-10 matches from MatchDG have over 50% overlap with ground-truth matches.

Table 11:

88.2 + 98.6 + 97.7 + 97.5 + 97.0 + 85.6
91.0 + 99.7 + 99.6 + 99.4 + 99.7 + 93.1
93.0 + 99.5 + 99.9 + 99.4 + 99.7 + 93.3
96.5 + 99.1 + 99.2 + 98.6 + 98.6 + 94.9

Table 12:

95.4 + 98.2 + 97.9 + 98.5 + 98.1 + 94.3
95.9 + 98.4 + 98.6 + 98.9 + 98.7 + 95.1

Table 18:

95.38 + 77.68 + 78.98 + 74.75

95.37 + 78.16 + 78.83 + 75.13
95.93 + 79.77 + 80.03 + 77.11
96.15 + 81.71 + 80.75 + 78.79

95.57 + 79.09 + 79.37 + 77.60
96.53 + 81.32 + 80.70 + 79.72
96.67 + 82.80 + 81.61 + 81.05

97.89 + 82.16 + 81.68 + 80.45
97.94 + 85.61 + 82.12 + 78.76
98.36 + 86.74 + 82.32 + 82.66

Table 19:

85.29 + 64.23 + 66.61 + 59.25

85.42 + 65.54 + 68.41 + 59.46
85.41 + 66.21 + 68.47 + 59.56
85.67 + 66.89 + 68.89 + 60.39

86.04 + 67.35 + 69.71 + 64.66
86.52 + 67.99 + 69.92 + 65.64
87.03 + 67.97 + 71.06 + 67.19